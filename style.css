const stars = document.getElementById('stars');
const ctx = stars.getContext('2d');
stars.width = window.innerWidth;
stars.height = window.innerHeight;

const starCount = 120;
const starArray = [];

for (let i = 0; i < starCount; i++) {
  starArray.push({
    x: Math.random() * stars.width,
    y: Math.random() * stars.height,
    size: Math.random() * 1.5,
    speed: Math.random() * 0.3 + 0.1
  });
}

function drawStars() {
  ctx.clearRect(0, 0, stars.width, stars.height);
  ctx.fillStyle = "#ffffff";
  for (let s of starArray) {
    ctx.globalAlpha = Math.random();
    ctx.fillRect(s.x, s.y, s.size, s.size);
    s.y += s.speed;
    if (s.y > stars.height) s.y = 0;
  }
  requestAnimationFrame(drawStars);
}
drawStars();

const whad = document.getElementById('whad');
const subtitle = document.getElementById('subtitle');
whad.addEventListener('mouseenter', () => subtitle.style.opacity = 1);
whad.addEventListener('mouseleave', () => subtitle.style.opacity = 0);

const dontClick = document.getElementById('dontClick');
const tooLate = document.getElementById('tooLate');

dontClick.addEventListener('click', () => {
  startCrash();
});

function startCrash() {
  const chart = document.getElementById('chart');
  chart.innerHTML = '';
  chart.style.position = 'absolute';
  chart.style.bottom = '20%';
  chart.style.left = '0';
  chart.style.width = '100%';
  chart.style.height = '200px';
  chart.style.zIndex = '4';

  const canvas = document.createElement('canvas');
  canvas.width = window.innerWidth;
  canvas.height = 200;
  chart.appendChild(canvas);
  const ctx2 = canvas.getContext('2d');
  
  let x = 0;
  let y = canvas.height - 50;
  let up = true;
  let color = 'lime';

  const interval = setInterval(() => {
    ctx2.strokeStyle = color;
    ctx2.lineWidth = 3;
    ctx2.beginPath();
    ctx2.moveTo(x, y);

    if (up) y -= 4;
    else y += 15;
    x += 10;

    ctx2.lineTo(x, y);
    ctx2.stroke();

    if (x > canvas.width / 2 && up) {
      up = false;
      color = 'red';
      document.body.classList.add('shake');
      setTimeout(() => document.body.classList.remove('shake'), 500);
    }

    if (x >= canvas.width) {
      clearInterval(interval);
      tooLate.style.opacity = 1;
      setTimeout(() => {
        tooLate.style.opacity = 0;
        chart.innerHTML = '';
      }, 3000);
    }
  }, 50);
}
